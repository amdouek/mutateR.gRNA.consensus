% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/recovery_pipeline.R
\name{recover_failed_genes}
\alias{recover_failed_genes}
\title{Recover failed genes using Ensembl REST API}
\usage{
recover_failed_genes(
  failed_genes,
  species = "hsapiens",
  nuclease = c("Cas9", "Cas12a", "enCas12a"),
  methods = NULL,
  tracr = "Chen2013",
  deephf_var = "wt_u6",
  exclude_mhc = FALSE,
  quiet = FALSE
)
}
\arguments{
\item{failed_genes}{Character vector of gene symbols, or path to failed_genes.rds}

\item{species}{Character. Ensembl species code (default "hsapiens")}

\item{nuclease}{Character. One of "Cas9", "Cas12a", "enCas12a" (default "Cas9")}

\item{methods}{Character vector. Scoring methods to use (default: auto-select)}

\item{tracr}{Character. tracrRNA for RuleSet3 (default "Chen2013")}

\item{deephf_var}{Character. DeepHF variant (default "wt_u6")}

\item{exclude_mhc}{Logical. Exclude MHC-region genes (default FALSE)}

\item{quiet}{Logical. Suppress progress messages (default FALSE)}
}
\value{
List with components:
\describe{
\item{recovered}{mutateR_consensus_batch of successfully recovered genes}
\item{still_failed}{Data frame of genes that could not be recovered}
\item{excluded_mhc}{Character vector of excluded MHC genes (if exclude_mhc=TRUE)}
\item{summary}{Recovery statistics}
}
}
\description{
Processes genes that failed primary pipeline analysis due to non-standard
sequence locations by retrieving sequences directly from Ensembl.
}
\details{
This function provides an alternative pathway for genes whose canonical
transcripts are annotated on GRC patches or alternative haplotypes.
Instead of using a BSgenome object, it retrieves sequences directly
from the Ensembl REST API, which has access to all annotated sequences.

The function:
\enumerate{
\item Re-retrieves gene/transcript information from Ensembl
\item Fetches exon sequences via REST API
\item Scans for PAM sites and extracts protospacers
\item Scores using the standard multi-method pipeline
\item Computes agreement statistics
}

Genes on MHC alternative haplotypes can optionally be excluded, as gRNAs
designed against these sequences will only work for individuals carrying
that specific HLA haplotype.
}
\section{Rate Limiting}{

The Ensembl REST API has rate limits (~15 requests/second). This function
includes appropriate delays to stay within limits. For large numbers of
failed genes, expect approximately 1-2 seconds per gene.
}

\examples{
\dontrun{
# After running primary analysis
primary_results <- run_exome_analysis(genes, "hsapiens", genome)

# Recover failed genes
recovery <- recover_failed_genes(
  "exome_analysis/failed_genes.rds",
  species = "hsapiens"
)

# View recovery statistics
recovery$summary

# Merge with primary results
merged <- merge_batch_results(
  readRDS("exome_analysis/final_results.rds"),
  recovery$recovered
)
}

}
